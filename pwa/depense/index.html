<!doctype html><html><head>
	<title>mes dépenses</title>
	<meta name='viewport' content='width=device-width,initial-scale=1'/>
	<meta charset='utf-8'/>
	<base target='_blank'>
	<link rel='manifest' href='manifest.webmanifest'/>
	<link rel='icon' type='image/png' href='static/icone-192.png'/>
	<meta name='msapplication-TileImage' content='static/icone-192.png'>
	<meta name='msapplication-TileColor' content='#C36'>
	<meta name='theme-color' content='#C36'/>
	<link rel='apple-touch-icon' type='image/png' href='static/icone-192.png'/>
	<meta name='apple-mobile-web-app-capable' content='yes'>
	<meta name='apple-mobile-web-app-status-bar-style' content='#C36'>
	<meta name='apple-mobile-web-app-title' content='mes dépenses'>
	<link rel='stylesheet' type='text/css' href='static/structure.css'/>
	<link rel='stylesheet' type='text/css' href='static/perso.css'/>
	<script type='text/javascript' src='static/database.js'></script>
	<script type='text/javascript' src='static/library.js'></script>
	<script type='text/javascript' src='static/dynaPlay.js'></script>
<style type='text/css'>
	form {
		display: grid;
		grid-template-columns: 6em 1fr;
		grid-gap: 0.5em;
	}
	table, tr { width: 100%; }
	input[type='text'].secret { display: none; }
</style></head><body>
	<h1>enregistrer mes dépenses</h1>
	<form>
		<label for='champ-date'>date</label><input type='date' id='champ-date' name='depDate'/>
		<label for='champ-lieu'>lieu</label><input type='text' class='secret' id='champ-lieu' name='depLieu' placeholder='nouvel endroit'/>
		<select name='depLieuSel' onchange="nouvelleValeur('lieu')" id='select-lieu'>
			<option value='(( lieuList ))'>(( lieuList ))</option>
			<option value='gdl'>gare de Lyon</option>
			<option value='nouveau'>nouvel endroit</option>
		</select>
		<label for='champ-categ'>catégorie</label><input type='text' class='secret' id='champ-categ' name='depCateg' placeholder='nouvelle catégorie'/>
		<select name='depCategSel' onchange="nouvelleValeur('categ')" id='select-categ'>
			<option value='(( cateList ))'>(( cateList ))</option>
			<option value='nouveau'>nouvelle catégorie</option>
		</select>
		<label for='champ-montant'>montant</label><input type='number' id='champ-montant' name='depMontant'/>
		<label for='champ-comm'>commentaire</label><input type='text' id='champ-comm' name='depComm'/>
		<input type='button' onclick='entrerDepense()' value='valider'/>
	</form>
	<h2>mes dépenses</h2>
	<table>
		<tr><th>date</th><th>lieu</th><th>catégorie</th><th>montant</th><th>commentaire</th></tr>
		<tr list='depenseList'><td>(( date ))</td><td>(( lieu ))</td><td>(( categorie ))</td><td>(( montant ))</td><td>(( commentaire ))</td></tr>
	</table>
	<button onclick='sauverModif()'>enregistrer vos modifs</button>
	<button id='install-pwa'>installer l'application</button>
	<script type='text/javascript' src='service-launcher.js'></script>
	<script type='text/javascript'>
const databaseName = 'depense';
var lieuList =[ 'rueil', 'bnf', 'châtelet', 'auber', 'paris', 'avon', 'chateaudun' ];
var cateList =[ 'courses', 'restaurant', 'transport', 'cadeau', 'ammeublement', 'divers', 'loisir', 'sortie', 'utile' ];

var depDate = new Date().toStringPerso();
var depLieu ="o";
var depLieuSel ="o";
var depCateg ="o";
var depCategSel ="o";
var depMontant = '15.0';
var depComm = 'ok';
var depenseList =[{ date: '2023-02-14', montant: '12.4', lieu: 'paris', categorie: 'sortie', commentaire: 'ras' }];
dpInit();

function trierDepenses (depenseA, depenseB){
	console.log ('o');
	if (depenseA.date < depenseB.date) return -1;
	else if (depenseA.date > depenseB.date) return 1;
	else if (depenseA.lieu < depenseB.lieu) return -1;
	else if (depenseA.lieu > depenseB.lieu) return 1;
	else if (depenseA.categorie < depenseB.categorie) return -1;
	else if (depenseA.categorie > depenseB.categorie) return 1;
	else if (depenseA.montant < depenseB.montant) return -1;
	else if (depenseA.montant > depenseB.montant) return 1;
	else if (depenseA.commentaire < depenseB.commentaire) return -1;
	else if (depenseA.commentaire > depenseB.commentaire) return 1;
	else return 1;
}
function nouvelleValeur (nom){
	const selector = document.getElementById ('select-' + nom);
	if (selector.options [selector.selectedIndex].value === 'nouveau'){
		selector.style.display = 'none';
		document.getElementById ('champ-' + nom).style.display = 'block';
}}
function entrerDepense(){
	if (depCateg === 'o') depCateg = depCategSel;
	if (depLieu === 'o') depLieu = depLieuSel;
	depenseList.push ({ date: depDate, montant: depMontant, lieu: depLieu, categorie: depCateg, commentaire: depComm });
	depenseList.sort (trierDepenses);
	console.log (depenseList);
	depDate = new Date().toStringPerso();
	depLieu ="o";
	depCateg ="o";
	document.body.innerHTML = bodyTemplate;
	dpLoad();
}
function sauverModif(){
	sendToIdb (databaseName, depenseList,
		function(){ sendToOdb (databaseName, depenseList); });
}
	</script>
</body></html>